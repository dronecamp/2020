---
title: "List_Sessions"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r results="asis", echo=FALSE}
ws_today <- ws_all %>% filter(session_date == this_day) %>% arrange(track_dtsort, track_nameonly, wkshp_dtsort)

track_name_last <- "none"

for (i in 1:nrow(ws_today)) {
  
  track_name_this <- ws_today$track_nameonly[i]
  hr_next <- TRUE
  
  if (is.na(track_name_this) || track_name_this == "none") {
    
    if (track_name_last != "none") {
       ## A track just ended, put in a horizontal bar
       print(p(" ", class = "trackend"))
       hr_next <- FALSE
    } 
    
  } else {
    if (track_name_this != track_name_last) {
      ## New track. Put a sub-heading
      #print(h2(track_name_this))
      #cat("### ", track_name_this, "\n", sep="")
      cat("## --- ", track_name_this, " --- {class='track' style='font-size:80%;'}\n", sep="")
      hr_next <- FALSE
    }
    
  }
  track_name_last <- track_name_this
  
  if (hr_next) print(HTML("<hr class=\"quarter\" style=\"height:2px;\"/>"))

  # print(p("last track ", track_name_last))
  # print(p("this track ", track_name_this))

  time_only <- str_trim(str_split(ws_today$dt_readable[i], pattern = "\\|")[[1]][2])
  
  cat("## <span class='time'>", time_only, ".</span> ", ws_today$title[i], "\n", sep="")
  
  if (!is.na(ws_today$desc[i])) print(HTML(paste0("<p>", ws_today$desc[i], "</p>")))
  
  if (ws_today$format[i] != "NA") print(p(strong("Format: "), ws_today$format[i]))
  
  ## Construct the instructors HTML text
  instr_html <- ""

  for (j in 1:3) {
    this_instr <- ws_today[i, paste0("inst", j, "_name"), drop=TRUE]
    if (!is.na(this_instr)) {
      if (toupper(this_instr) != "NA") {
        
        id_find <- tolower(gsub(" ", "-", this_instr))
        if (id_find %in% dc20_instr_tbl$id) {
          a1 <- paste0( "<a href=\"instructors.html#", id_find, "\">")
          a2 <- "</a>\n"
        } else {
          a1 <- ""
          a2 <- "\n"
        }
        
        instr_html <- paste0(instr_html, ifelse(j==1, "", ", "), a1, this_instr, a2)
      }
    }
  }
  
  if (instr_html != "") print(p(strong("Instructor(s): "), HTML(instr_html)))
  
  if (!is.na(ws_today$prereqs[i])) {
    print(HTML(paste0("<p><strong>Pre-requisites</strong>: ", ws_today$prereqs[i], "</p>")))
  }
  
  if (!is.na(ws_today$instructions[i])) {
    print(HTML(paste0("<p><strong>Additional instructions</strong>: ", ws_today$instructions[i], "</p>")))
  }

  if (!is.na(ws_today$zoom_url[i])) {
    print(HTML(paste0("<p><strong>Zoom</strong>: ", ws_today$zoom_url[i], "</p>")))
  }

  ## Construct the resources list HTML text
  res_html <- ""
  for (j in 1:4) {
    if (!is.na(ws_today[i, paste0("res0", j, "_name"), drop=TRUE])) {
      res_html <- paste0(res_html, "<li>",
                         ifelse(!params$render_links || is.na(ws_today[i, paste0("res0", j, "_url"), drop=TRUE]), "", 
                                paste0("<a href=\"", ws_today[i, paste0("res0", j, "_url"), drop=TRUE], 
                                       "\" target=\"_blank\" rel=\"noopener\">")),
                         ws_today[i, paste0("res0", j, "_name"), drop=TRUE],
                         ifelse(!params$render_links || is.na(ws_today[i, paste0("res0", j, "_url"), drop=TRUE]), "", "</a>"), 
                         "</li>")
    }
  }
  
  if (nchar(res_html) > 0) {
    print(p(strong("Materials:")))
    print(HTML(paste0("<ul>", res_html, "</ul>")))
  }

}

```
